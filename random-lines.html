<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>AR.js demo Stars</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-lines@1.1.0/lines.js"></script>
    <script>
      function seq(count, step = 1, start = 0) {
        return Array.from({ length: count }).map((_, i) =>
          typeof step === "function" ? step(i + start) : i * step + start
        );
      }

      function range(from, to, step = 1) {
        const reversed = to < from;
        if (reversed) {
          [to, from] = [from, to];
        }
        const length = Math.floor((to - from) / step) + 1;
        const output = seq(length, step, from);
        return reversed ? output.reverse() : output;
      }

      function deg2rad(deg = 0) {
        return (deg * Math.PI) / 180;
      }

      function rad2deg(rad = 0) {
        return (rad * 180) / Math.PI;
      }

      function pol2car(angle, radius) {
        return [
          Math.cos((angle - 90) * (Math.PI / 180)) * radius,
          Math.sin((angle - 90) * (Math.PI / 180)) * radius,
        ];
      }

      function car2pol(point) {
        const [x, y] = point;
        return [Math.atan2(y, x) * (180 / Math.PI), Math.sqrt(x * x + y * y)];
      }

      function remap(value, start1, stop1, start2, stop2) {
        return (
          ((value - start1) / (stop1 - start1)) * (stop2 - start2) + start2
        );
      }

      function random(min = 0, max = 1) {
        return min + Math.random() * (max - min);
      }

      function flattenPoints(points) {
        return points.map((p) => p.join(" ")).join(",");
      }

      /*
        v-for="a in range(0,360,360/10)"
        :position="[...pol2car(a,5),-80].join(' ')"
        */

      function generatePoints() {
        const maxDegrees = 360 * 3;
        const pointsCount = 100;
        const radius = 10;
        return range(0, maxDegrees, maxDegrees / pointsCount)
          .map((angle) => [
            ...pol2car(angle, radius), // returning [x,y]
            0,
          ])
          .map(([x, y, z]) => [x + random(-1, 1), y + random(-1, 1), z]);
      }

      AFRAME.registerComponent("random-lines", {
        init: function () {
          const points = generatePoints();
          const lines = document.createElement("a-lines");
          lines.id = "random-lines";
          const scene = document.querySelector("a-scene");
          lines.setAttribute("points", flattenPoints(points));
          lines.setAttribute("color", "blue");
          lines.setAttribute("position", "0 0 -80");
          lines.setAttribute("rotation", [100, 0, 0].join());
          scene.appendChild(lines);
        },
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene
      random-lines
      id="scene"
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-sphere
        position="0 5 -80"
        material="color:red; opacity: 0.5"
        radius="1"
      ></a-sphere>
      <!-- <a-lines points="0 5 -80, 1 4 -70, 0 3 -80" color="blue"></a-lines> -->
      <a-camera> </a-camera>
    </a-scene>
  </body>
</html>
